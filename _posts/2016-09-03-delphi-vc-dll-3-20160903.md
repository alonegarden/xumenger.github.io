---
layout: post
title: Delphi配合VC++开发：Visual C++使用说明
categories: delphi之dll c/c++之dll c/c++之指针与内存 delphi之指针与内存
tags: c++ c delphi dll 导出函数 回调函数 函数指针 VC++ Delphi配合VC++开发
---

## .dll文件的配置

* .dll文件是在程序运行时加载的，在编译时用不到
* 可能需要在代码中指定.dll的路径
* 然后部署时将.dll放到正确的路径下（是程序对应的目录，而不是源码的对应目录）

##.lib文件的配置

对所有工程都生效的配置

* 【工具】-->【选项】-->【目录】，设置“Library files”
  * 将本工程需要引用的.lib文件所在的目录添加一下
  * 不过这样的配置是针对VC++的，而不是针对某个具体的工程的
  * 注意如果'./lib'和'./lib/app'都有.lib文件，那么这两个路径都要在这里配置
* 因为会作用到所有的VC++工程，所以必须考虑是否造成不同工程之间的冲突
* 注意，如果配置好的文件路径变更，会导致编译报错
  * 一般这就是直接拷贝别人环境的程序源码无法编译的原因
  * 所以如果拷贝别人的项目源码，必须在自己的环境做对应的路径维护

针对具体工程的配置

* 在【工程】-->【设置】-->【连接】-->【对象/库模块】 这个编辑框中配置编译需要的lib名
* 保留原有的默认引用的.lib，一般有：kernel32.lib user32.lib gdi32.lib
* 还有：winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib
* 还有：oleaut32.lib uuid.lib odbc32.lib odbccp32.lib
* 然后添加需要的lib，因为已维护好路径，所以再配置.lib的文件名即可
* 如果有多个lib文件，那么用空格进行分割，比如在工程的lib目录下游多个.lib文件，可以在这里添加 lib\test1.lib lib\test2.lib

建议的方式

* 与某个具体工程相关的还是要使用第二种方式进行配置
* 与具体工程无关的，想要作用到所有工程上的，使用第一种方式
* 要将两种区分开来配置，不要混在一起

## .h文件的配置方式

对所有工程都生效的配置

* 【工具】-->【选项】-->【目录】，设置“Include files”
  * 将本工程所需要的.h文件所在的目录都添加一下
  * 若'./include'和'./include/app'都有.h文件，那这两个路径都要在这里配置
  * 然后在编程时包含.h文件的时候，可以直接#include "test.h"，而不用关心它的目录！
* 因为会作用到所有的VC++工程，所以必须考虑是否造成不同工程之间的冲突
* 注意，如果配置好的文件路径变更，会导编译报错
  * 一般这就是直接拷贝别人环境的程序源码无法编译的原因
  * 所以如果拷贝别人的项目源码，必须在自己的环境做对应的路径维护

针对具体工程的配置

* 安装插件“FileTool.exe”，解决VC++“添加文件到目录”、“打开...”崩溃的问题
* 这个插件的安装方式自己上网搜索
* 现在就可以通过插件来添加.h文件
* 点击插件的'A'按钮，添加所有需要的.h文件
* 对于这种方式的配置的.h文件，还是要在引用时指定路径，比如这个工程的include目录下有.h文件，要`#include "include\test.h"`而不能`#include "test.h"`

建议的方式

* 与某个具体工程相关的还是要使用第二种方式进行配置
* 与具体工程无关的，想要作用到所有工程上的，使用第一种方式
* 并且在引用.h文件时，注意第一种不用致指明路径，第二种还是要指明相对路径
* 要将两种区分开来配置，不要混在一起

## 编译和调试

配置编译输出路径

* 比如编译输出Exe或者dll文件
* 【工程】-->【设置】-->【连接】-->【输出文件名】，这个编辑框设置：bin/TestApp.exe
* 【工程】-->【设置】-->【连接】-->【输出文件名】，这个编辑框设置：bin/TestApp.dll

调试的配置

* 可以调试EXE、也可以调试DLL
* 另外参考下面的《调试过程中常见报错和解决方法》
* 【工程】-->【设置】-->【连接】，设置“编译输出路径”，一定要输出在调试用到的路径上
* 【工程】-->【设置】-->【调试】，设置“可执行调试对话”，一定要是调试用到的可执行文件

常用快捷键

* Ctrl+F7：Compile(编译)
* F7：Build(组建)
* F9：加断点、去除断点
* F5：开始调试
* F10：单步
* F11：单步进入
