---
layout: post
title: 初识Lisp语法
categories: lisp之基础语法
tags: lisp 数学 几何 语义 逻辑学 垃圾回收 语法
---

关于Lisp，流传着很多的说法：

>如果你会用Lisp语言，你就会拥有超人的编程能力

>Lisp和Fortran代表了编程语言发展的两大方向。前者的基础是数学，后者的基础是硬件架构

>Lisp这一类语言迎合的是数学家的本性，而不是程序员的本性

>Lisp实际上是数学，而数学是不会过时的

>Lisp并不只是说代码上的抽象，相对于你学习java之后，再去看Lisp，就会颠覆你对原本程序世界的认知，有种重塑三观的感觉

>Lisp是适合人工智能（AI）的语言

>Lisp是很好的思维训练的载体，以λ演算而不是图灵机作为计算模型对于初学者是一种思维上的飞跃，有很高的学习价值

>Lisp的语法是世界上最精炼、最美观，也是语法分析起来最高效的语法

>Lisp 是第一个可以在程序的任何位置定义函数，并且可以把函数作为值传递的语言。这样的设计使得它的表达能力非常强大。这种理念被Python，JavaScript，Ruby等语言所借鉴

>Lisp是世界上最强大的宏系统。这种宏系统的表达力几乎达到了理论所允许的极限。如果你只见过C语言的宏，那我可以告诉你它是完全无法与Lisp的宏系统相提并论的

>Lisp是世界上第一个使用垃圾回收的语言。这种超前的理念，后来被Java、C#等语言借鉴

最近，听到和看到很多人、很多书，都在“鼓吹”Lisp，我的好奇心难免被勾起来：它的语法是什么样的？它到底和我常用的编程语言有什么不同？它可以在什么领域应用？

另外说明一下我的一个纠结：都说Lisp和常见的编程语言，比如C/C++、Pascal、Java有很大的不同，是不是在学习Lisp的时候不能按照学习这些常见编程语言的思路，在思考和应用Lisp的时候应该规避其他常用编程语言对我思维的束缚？

在学习之前我能想到的对于自己的建议：不要成为语法的奴隶；学习不要止于语法，思考语法背后的思想，为什么设计成这个样子、思考其和类C语言在设计上的异同……

Lisp有很多方言，Common Lisp、Scheme等，选择哪个更好？

一切都不得而知，那就先走一步看一步吧！

推荐教程：[《Lisp 入门》](https://zh.wikibooks.org/wiki/Lisp_%E5%85%A5%E9%96%80)

首先需要获得一个Lisp解释器（或谓实现），可以使用[GNU Common Lisp](http://www.gnu.org/software/gcl/)，也可以使用[Clozure CL](http://ccl.clozure.com/)

## 程序与数据

编程这项工作，是在写一个程序，而写程序的目的是为了处理数据。程序与数据是编程中的两大要素，而在Lisp中，这两者都用**表**来表示

如果你在解释器中输入一个表，那么Lisp会对这个表求值。所以在解释器中输入

```
(+ 1 2)
```

会打印3，说明这个表的值是3。可以看到在Lisp中，数学表达式要用括号括起来，并且运算符要放在第一个，运算数放在后面，中间用必要的空格隔开。上面表达式中的运算符，即第一个符号，称之为**操作符**，而其他的符号，称之为**操作域**。这种把操作符放在第一个位置的表达方式，称之为**前缀表达式**，也被叫做**波兰表达式**。其实我们在初学数据结构与算法的时候，实现一个计算机就是应用前缀表达式

在数学中，函数是一个函数名，后面跟着一个括号，括号里面装着参数。但在Lisp中，整个函数表达式用括号括起来，第一个元素是函数的名称，后面安跟着函数的参数

比如在数学中的函数格式**y = f(x)**在Lisp中应该是**(f x)**；数学中的函数格式**z = f(x, y)**在Lisp中应该是**(f x y)**；...

如果在解释器中输入

```
(1 2 3)
```

会得到一个错误：Error: 1 is invalid as a function. 意思是1不是一个可用函数

在所有的表中，第一个原子总是函数，代表操作、指令、命令。而之后的原子（或表）是参数，意即对操作的说明。所以 (+ 1 2)表示 1+2，而 (- 4 3)表示 4-3

例外是这个

```
()
```

这是一个空表，会返回 NIL。NIL是一个原子，表示逻辑假，但它同时也是空表。他是Lisp语言中唯一一个既是表又是原子的东西

程序是表，那数据该如何表示？数据也是用表来表示的

Lisp对所有的表求值，但如果我们想使用表本身（作为数据），这反而会成为一件麻烦事。只要用一个简单的额操作符就可以防止求值，那就是 ' 操作符（单引号）

```
'(+ 1 2)
```

这次解释器不对这个表求值了，结果不再是3这个原子，而是输出一个表，原封未动的表

```
(+ 1 2)
```

输出Hello World可以使用

```
'(Hello world!)
```

或者使用 ' 的全称，也就是quote操作，意思是引用

```
(quote (Hello world!))
```

得到

```
(HELLO WORLD!)
```

## Lisp七大公理

Lisp有7个基本操作符（实际上或许可以再精简）。这7个操作符就像几何中的公理一样，任何其他函数都可以由这七大公理定义。也就是说，7个基本操作符包含了Lisp的所有语义

* **Quote**。(quote x)返回x，等价于 'x
* **Atom**，判断一个字符序列是不是原子。(atom 'a)返回T，因为a是一个原子；(atom '(3))，返回NIL，表示假，因为(3)是一个列表，不是原子
* **Eq**，判断两个原子或空表是否相等。(eq 1 1)，返回T；(eq 1 '(1 2))返回NIL；(eq '(1 2) '(1 2))返回NIL，因为'(1 2)不是原子或空表；(eq () ())返回T，因为两个空表相等
* **Car**，用于取出表的第一个元素。(car '(1 2 3))返回1；(car '((1 2) 3))返回(1 2)
* **Cdr**，和Car相反，用于去除表的第一个元素。(cdr '(1 2 3 4))返回(2 3 4)
* **Cons**，用于合并一个表。(cons 1 '(2 3))返回(1 2 3)
* **Cond**，形式为(cond 分支列表1 分支列表2 ... 分支列表N)，其中列表的构成为(条件p 值e)，对每个“条件p”求值，如果未NIL，就接着求下一个，如果未T，就返回相应的“值e”，不再继续处理下一个，如果没有真值，返回NIL。(cond (nil 1) (nil 2) (t 3))返回3；(cond (t 1) (nil 2) (t 3))返回1

基于这7个基本操作符，任何其他函数都可以定义得到

但首先需要学习Lisp定义函数的语法，主要使用关键字 defun，比如定义一个相加函数

```
(defun add(x y)
	(+ x y)
)
```

然后可以通过以下方法调用，返回两个整数的和

```
(add 2 3)
```

基于七大基本操作符实现if、while、or等函数

实现NULL函数，NULL函数用于检测表是否为空，或者元素是否为NIL

```
(defun null2 (x) (cond ((equal x nil) t) (t nil)))
```

解释：如果参数与NIL相等，就返回T，否则返回NIL。这和逻辑学上的not函数是一致的（但NULL函数的应用范围更广，因为它可以应用于表）

if函数的表示。用cond可以实现if函数。实际上，在类C语言中，if语句强调的是程序的走向，但在Lisp中，程序对的走向可以忽略（从某种意义上），而强调的是返回值

```
(defun if2 (p e1 e2)
	(cond (p e1) (t e2))
)
```

>思考，为什么这7个操作符包含了Lisp的所有语义；扩展：为什么数学可以基于几条基本的公理而推导出整个庞大的数学体系。如何去证明？

## Lisp有什么用？

像C/C++、Java、Python、Delphi这些语言一方面有其基础的语法可以定义类、定义函数、执行指令；一方面有操作系统层面的支持，比如进行多线程开发、多进程编程去充分利用CPU资源，可以通过网络编程实现通信和Web开发等

那Lisp呢？难道就止于以上这些语法了吗？还有没有其他更多的东西？它到底可以应用在什么领域呢？到底可以开发些什么产品呢？

《黑客与画家》讲到Lisp可以做网络商店，而且开发效率很高

另外其他还有什么领域呢？

## 参考文章

* [《为什么Lisp语言如此先进？（译文）》](http://www.ruanyifeng.com/blog/2010/10/why_lisp_is_superior.html)
* [《LISP 语言是怎么来的》](https://blog.youxu.info/2009/08/31/lisp-and-ai-1/)
* [《Lisp 入门》](https://zh.wikibooks.org/wiki/Lisp_%E5%85%A5%E9%96%80)
* [Lisp能被用来做什么？](https://www.zhihu.com/question/20044783)
* [《我为什么要学 Common Lisp》](https://my.oschina.net/u/563463/blog/158338)
* [《Lisp 已死，Lisp 万岁！》](http://www.yinwang.org/blog-cn/2013/03/26/lisp-dead-alive)
* [Lisp 语言优点那么多，为什么国内很少运用？](https://www.zhihu.com/question/24447820)
* [对Lisp新手来说，学习哪种方言、使用哪些参考书和开发软件更适合？](https://www.zhihu.com/question/19734980)
