---
layout: post
title: 服务熔断
categories: java之设计模式 java之多线程 大型系统架构 
tags: java RxJava HyStrix 服务熔断 设计模式 观察者设计模式 多线程 事件驱动 响应式编程 流 服务降级 服务限流 高可用性 微服务 分布式 雪崩
---

## 雪崩现象

在[《分布式调用链监控》](http://www.xumenger.com/distributed-trace-20181101/)中讲到了在微服务分布式系统中，可能存在很长的调用链，正常的情况下是这样的

![](../media/image/2018-11-21/01.png)

那么很显然，如果其中的某个环节因为网络问题或者程序开发的质量不高导致不可用（比如调用超时、一直处理错误……），那么在这个链路之前的环节都会受到影响

![](../media/image/2018-11-21/02.png)

因为服务提供者的不可用导致服务调用者的不可用，并将不可用逐渐放大，最终可能导致雪崩效应！

形成雪崩效应的过程大概是下面这样的

* 服务提供者不可用
	* 硬件故障，比如服务提供者的主机宕机、网络硬件故障导致服务提供者不可访问
	* 服务提供者程序逻辑的Bug
	* 缓存击穿：缓存击穿一般发生在缓存应用重启，所有缓存被清空时，以及短时间内大量缓存失效时，大量的缓存不命中，使请求直击后段，造成服务提供者超负荷运行，引起服务不可用
	* 大量用户请求：在秒杀和大促销开始前，如果准备不充分，用户发起大量请求也会造成服务提供者的不可用
* 重试加大流量
	* 用户重试：在服务提供者不可用后，用户由于忍受不了界面上长时间的等待，而不断刷新页面甚至提交表单
	* 代码逻辑重试：服务调用端会存在大量服务提供者异常后的重试逻辑
* 服务调用者不可用
	* 同步等待造成的资源耗尽，比如会产生大量的等待线程占用系统资源，一旦线程资源被耗尽，服务调用者提供的服务也将处于不可用状态

服务提供者不可用，导致服务调用者不可用，再导致前面的服务调用者不可用……最终导致程序的雪崩效应！

## 搭建HyStrix环境
