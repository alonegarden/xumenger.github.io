---
layout: post
title: Spring的依赖注入
categories: java之web开发 java之web框架 
tags: Java IoC DI 依赖注入 Spring SpringBoot maven
---

最近在研究Spring、SpringBoot，今天看到了两篇很好的文章，准备根据这两篇文章动手实践一下

>[《SpringBoot系列: 理解 Spring 的依赖注入(一)》](https://www.cnblogs.com/harrychinese/p/spring_ioc.html)

>[《SpringBoot系列: 理解 Spring 的依赖注入(二)》](https://www.cnblogs.com/harrychinese/p/spring_ioc2.html)

## Spring的依赖注入

对于Spring 程序，Spring 框架为我们提供了一个IoC 容器，该容器负责创建对象和维护对象之间的依赖关系

ApplicationContext 即是Spring 的IoC 容器，该容器负责创建Bean，并将功能类Bean 注入到你需要的Bean 中，那么，Spring 是如何知道我们有哪些Bean 类，以及这些类的依赖关系是什么？有三种配置方式告知Spring 程序，分别是XML 配置方式、注解配置方式、Java 配置方式

ApplicationContext 是Spring 程序的核心，不管是Spring 程序，还是Spring MVC 程序，还是Spring Boot 程序，其main() 函数主要的代码就是初始化ApplicationContext 容器，Spring 框架为我们提供了多种容器实现，可以针对不同的应用场景选择

* AnnotationConfigApplicationContext: 该容器读取从一个或多个基于Java 的配置类，适用于Java 配置方式
* AnnotationConfigWebApplicationContext: 专门为Web 应用准备的，适用于注解方式
* XmlWebApplicationContext: 该容器读取一个或多个XML 配置文件，使用于XML 配置方式
* ClassPathXmlApplicationContext, 该容器从classpath 路径下读取XML 配置文件,使用于XML 配置方式

比如示例代码

```java
ApplicationContext context = new ClassPathXmlApplicationContext("resouces/applicationContext.xml");

// 或者
ApplicationContext context = new AnnotationConfigApplicationContext(ManConfig.class);
```

## 三种Bean配置方式

**XML 配置方式**：老的程序中经常见到，比如将Spring Bean 声明放到applicationContext.xml 中

**注解配置方式**：在类定义时通过@Service、@Controller、@Repository、@Component 声明为Spring Bean

* @Service：用于业务服务层
* @Controller：用于展现层
* @Repository：用于DAO 层
* @Component：通用组件，它是上面3 个注解的父注解，没有明确的角色，对于普通的组件最好使用@Component 注解

**Java 配置方式**：该方法是通过@Configuration + @Bean 实现的。该方式引入一个Config 类，在类中通过方法函数声明Bean 类，而Pojo 类定义不加@Componenet 之类的注解，Config 类需要加上@Configuration 注解，Config 类中的Bean 方法需要加上@Bean 注解

@Configuration 等同于XML 配置中的<beans></beans> 标签，需说明的是@Configuration 其实也是@Component 的一个子注解

@Bean 等同于XML 配置中的<bean></bean> 标签。@Bean 用来注解一个函数，该函数应该是一个Bean 对象，Bean 对象的名称是方法名

>最佳实践：注解配置的方式和Java 配置方式没有孰优孰劣，理论上是可以相互替换的，但可以总结一个最佳实践，全局性的配置用Java 配置（比如数据库的相关配置，MVC 相关配置），业务Bean 配置使用注解配置，尽量少用XML 配置方式

## 搭建测试环境

在Eclipse 上创建一个Maven 项目

![](../media/image/2018-12-06/01.png)

修改pom.xml 内容，引入spring-context 依赖，内容为

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>TestSpring</groupId>
  <artifactId>TestSpring</artifactId>
  <version>0.0.1-SNAPSHOT</version>
  <name>TestSpring</name>
  
  <dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>4.3.10.RELEASE</version>
    </dependency>
  </dependencies>
</project>
```

等待依赖下载

![](../media/image/2018-12-06/02.png)

