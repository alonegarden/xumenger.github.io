---
layout: post
title: Unity Shader语法
categories: 游戏开发之unity
tags: Unity Shader 渲染 GPU 渲染管线 着色器 材质 贴图 UV 特效 UV动画 C# Pass 动画 
---

先看一下一个“粗制滥造”的旗帜飘扬的效果。旗帜飘扬，而且旗帜上面的贴图会像跑马灯一样播放

![](../media/image/2020-06-06/01.gif)

对应的Shader 代码是这样的

```shader
Shader "Unlit/Flag Unlit Shader"
{
    Properties
    {
        _MainTex ("Texture", 2D) = "white" {}
    }

    SubShader
    {
        Tags { "RenderType"="Opaque" }
        LOD 100

        Pass
        {
            CGPROGRAM

            #pragma vertex vert
            #pragma fragment frag
            // make fog work
            #pragma multi_compile_fog

            #include "UnityCG.cginc"

            struct appdata
            {
                float4 vertex : POSITION;
                float2 uv : TEXCOORD0;
            };

            struct v2f
            {
                float2 uv : TEXCOORD0;
                UNITY_FOG_COORDS(1)
                float4 vertex : SV_POSITION;
            };

            sampler2D _MainTex;
            float4 _MainTex_ST;

            v2f vert (appdata v)
            {
                v2f o;

                v.vertex.y = cos(v.vertex.x + _Time.w);

                o.vertex = UnityObjectToClipPos(v.vertex);
                o.uv = TRANSFORM_TEX(v.uv, _MainTex);
                UNITY_TRANSFER_FOG(o,o.vertex);
                return o;
            }

            // 片元着色器
            fixed4 frag (v2f i) : SV_Target
            {
                float2 offset = float2(0, 0);
                offset.x = _Time.y * 0.25;
                offset.y = _Time.y * 0.25;

                // sample the texture
                fixed4 col = tex2D(_MainTex, i.uv + offset);

                // apply fog
                UNITY_APPLY_FOG(i.fogCoord, col);
                return col;
            }

            ENDCG
        }
    }
}
```

## 拆解以上代码介绍Shader语法




## 在C# 代码中调用Shader脚本播放特效

下面的代码只是展示C# 中与Shader、Material 交互API 的例子而已

除了在Shader 中使用\_Time 变量来实现动画效果，也可以结合C# 和Shader 来实现动画效果

```C#
using UnityEngine;
using System;
using System.Collections;
using System.Collections.Generic;

public class CallShader: MonoBehaviour
{
    private Shader myShader;
    private Material myMaterial;

    private float values;

    void Start()
    {
        // 通过Shader的名称找到对应的Shader
        myShader = Shader.Find("Unlit/Flag Unlit Shader");

        // 创建一个材质
        myMaterial = new Material(myShader);

        values = 0;
    }

    // 在完成了所有的图像渲染后，调用这个函数
    void OnRenderImage(RenderTexture rta, RenderTexture rtb)
    {
        if (null != myShader)
        {
            // 渲染材质
            Graphics.Blit(rta, rtb, myMaterial);
        }
        else 
        {
            Graphics.Blit(rta, rtb);
        }
    }

    void Update()
    {
        values = Mathf.Lerp(values, 1f, Time.deltaTime * 0.5f);

        // 为Shader的_Value属性赋值
        myMaterial.SetFloat("_Value", values);
    }
}
```
