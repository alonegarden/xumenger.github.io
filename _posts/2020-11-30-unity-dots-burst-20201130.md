---
layout: post
title: Unity DOTS 技术：Burst 编译器
categories: 游戏开发之unity
tags: Unity UD ECS 性能 内存 DOD 面向数据编程 DOTS C# 委托 HybridECS Burst 编译器 中间代码 Mono IL2CPP .Net LLVM 
---

>Brust 编译器是Unity 开发的全新快速编译器，使得项目性能有了更大的提升。现在C# 写的代码首先要转换成中间代码，这样就会比较慢，Unity 就自己开发了Brust 编译器使得C# 代码不经过中间代码，直接变成汇编

Unity.Mathematics 数学库提供了矢量类型（float4、float3……），可以直接映射到硬件SIMD 寄存器。Unity.Mathematics 的Math 类中也提供了直接映射到硬件SIMD 寄存器，这样原本CPU 需要一个一个计算得到，有了SIMD 可以一次性计算完毕。注意Unity 之前的Math 类默认是不支持映射SIMD 寄存器的。还有需要注意的一点是Unity.Mathematics 必须和Burst 编译器配合使用，不使用Burst 的话，只在一个普通的脚本中编写是没有意义的

Unity.Mathematics 建议使用float3 代替Vector3，使用quaternion 代替Quaternion！

.Net Core 比C++ 慢了2 倍；Mono 比.Net Core 慢3 倍；IL2CPP 比Mono 快2-3 倍，IL2CPP 于.Net Core 效率相当，但依然比C++ 慢2 倍；Unity 使用Burst 编译后可以让C# 代码的运行效率比C++ 更快！

## LLVM



## 使用Burst 优化程序

在上两篇文章中，使用了HybridECS 和C# Job 开发了一个简单的案例，本文在上面代码的基础上添加Burst 支持，看一下优化后的效果



Jobs -> Burst -> Open Inspector 即可打开Burst 编译面板窗口。配合[https://software.intel.com/sites/landingpage/IntrinsicsGuide/](https://software.intel.com/sites/landingpage/IntrinsicsGuide/) 分析编译出来的代码是否是最优的！

## 扩展内容

以上对于ECS、C# Job、Burst 的原理、使用进行了简单的了解，基于这个框架进行开发是足够了的

除此之外还是有其他很多需要深究和扩展的，包括：ECS 具体的内存分布细节、LLVM、DOTS 物理引擎、Mathematics 数学库、DOTS 技术栈下如何实现3D 动画、Shader 原理与优化
